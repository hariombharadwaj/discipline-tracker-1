<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Discipline System</title>
    <meta name="description" content="Track violations and maintain discipline with the Iron Rules System">
    <meta name="theme-color" content="#FF6B6B">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSXJvbiBEaXNjaXBsaW5lIFN5c3RlbSIsInNob3J0X25hbWUiOiJJcm9uRGlzY2lwbGluZSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjRkY2QjZCIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qUWlJR2hsYVdkb2REMGlNalFpSUhabGNuTnBiMjQ5SWpFdU1TSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklpQjJhV1YzUW05NFBTSXdJREFnTWpRZ01qUWlQanh5WldOMElIZHBaSFJvUFNJeU5DSWdhR1ZwWjJoMFBTSXlOQ0lnWm1sc2JEMGlJMFpHT2tKQ1FpSXZQand2YzNablBnPT0iLCJzaXplcyI6IjI0eDI0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iI0ZGNkI2QiIvPjwvc3ZnPg==">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .gradient-text { background: linear-gradient(to right, #DC2626, #EA580C, #CA8A04); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .transform { transform: translateZ(0); }
        .transition-all { transition: all 0.3s ease; }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .rounded-3xl { border-radius: 1.5rem; }
        @media (max-width: 640px) {
            .text-5xl { font-size: 2.5rem; }
            .p-8 { padding: 1.5rem; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50">
    <div id="app" class="min-h-screen p-2 sm:p-4 md:p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 mb-6 md:mb-8">
                <div class="text-center">
                    <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold gradient-text mb-3">
                        ‚ö° IRON DISCIPLINE SYSTEM
                    </h1>
                    <p class="text-gray-600 text-sm sm:text-base md:text-lg mb-4 md:mb-6">Forge yourself through fire and discipline</p>
                    
                    <div class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-4">
                        <button onclick="showExportModal()" class="flex items-center space-x-1 sm:space-x-2 px-3 sm:px-4 md:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg sm:rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm sm:text-base">
                            <i data-lucide="file-down" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                            <span>Export</span>
                        </button>
                        
                        <label class="flex items-center space-x-1 sm:space-x-2 px-3 sm:px-4 md:px-6 py-2 sm:py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg sm:rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 cursor-pointer text-sm sm:text-base">
                            <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                            <i data-lucide="download" class="w-4 h-4 sm:w-5 sm:h-5 rotate-180"></i>
                            <span>Import</span>
                        </label>
                        
                        <button onclick="shareApp()" class="flex items-center space-x-1 sm:space-x-2 px-3 sm:px-4 md:px-6 py-2 sm:py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg sm:rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm sm:text-base">
                            <i data-lucide="share-2" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                            <span>Share</span>
                        </button>
                        
                        <button onclick="clearAllData()" class="px-3 sm:px-4 py-2 bg-red-600 text-white rounded-lg text-xs sm:text-sm font-bold hover:bg-red-700 transform hover:scale-105 transition-all duration-300">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                    
                    <div class="p-3 sm:p-4 bg-blue-50 rounded-xl border border-blue-200">
                        <div class="text-center">
                            <p class="text-blue-800 font-bold text-xs sm:text-sm">üíæ PERSISTENT STORAGE ACTIVE</p>
                            <p id="status" class="text-blue-600 text-xs mt-1">Status: üîÑ Ready</p>
                            <p id="records" class="text-blue-500 text-xs mt-1">Records: 0 violations ‚Ä¢ 0 rule breaches</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-2 sm:p-3 mb-6 sm:mb-8">
                <div class="flex flex-wrap justify-center gap-1 sm:gap-2">
                    <button onclick="setActiveTab('dashboard')" id="tab-dashboard" class="tab-btn flex items-center space-x-1 sm:space-x-2 md:space-x-3 px-3 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm md:text-base bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-lg">
                        <i data-lucide="bar-chart-3" class="w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Dashboard</span>
                    </button>
                    <button onclick="setActiveTab('rules')" id="tab-rules" class="tab-btn flex items-center space-x-1 sm:space-x-2 md:space-x-3 px-3 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm md:text-base hover:bg-gray-100 text-gray-600">
                        <i data-lucide="target" class="w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Rules</span>
                    </button>
                    <button onclick="setActiveTab('logs')" id="tab-logs" class="tab-btn flex items-center space-x-1 sm:space-x-2 md:space-x-3 px-3 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm md:text-base hover:bg-gray-100 text-gray-600">
                        <i data-lucide="scroll-text" class="w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Logs</span>
                    </button>
                    <button onclick="setActiveTab('charts')" id="tab-charts" class="tab-btn flex items-center space-x-1 sm:space-x-2 md:space-x-3 px-3 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm md:text-base hover:bg-gray-100 text-gray-600">
                        <i data-lucide="trending-up" class="w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Charts</span>
                    </button>
                    <button onclick="setActiveTab('history')" id="tab-history" class="tab-btn flex items-center space-x-1 sm:space-x-2 md:space-x-3 px-3 sm:px-4 md:px-6 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm md:text-base hover:bg-gray-100 text-gray-600">
                        <i data-lucide="history" class="w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">History</span>
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div id="content">
                <!-- Dashboard Tab -->
                <div id="dashboard-content" class="space-y-6 sm:space-y-8">
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
                        <div class="bg-gradient-to-br from-red-400 to-red-600 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 text-white shadow-2xl">
                            <div class="text-center">
                                <i data-lucide="alert-triangle" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 mx-auto mb-2 sm:mb-4"></i>
                                <p class="text-red-100 text-xs sm:text-sm font-bold mb-1 sm:mb-2">Total Violations</p>
                                <p id="total-violations" class="text-2xl sm:text-3xl md:text-5xl font-black">0</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-400 to-red-500 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 text-white shadow-2xl">
                            <div class="text-center">
                                <i data-lucide="flame" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 mx-auto mb-2 sm:mb-4"></i>
                                <p class="text-orange-100 text-xs sm:text-sm font-bold mb-1 sm:mb-2">Critical</p>
                                <p id="critical-violations" class="text-2xl sm:text-3xl md:text-5xl font-black">0</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 text-white shadow-2xl">
                            <div class="text-center">
                                <i data-lucide="calendar" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 mx-auto mb-2 sm:mb-4"></i>
                                <p class="text-green-100 text-xs sm:text-sm font-bold mb-1 sm:mb-2">Clean Days</p>
                                <p id="clean-days" class="text-2xl sm:text-3xl md:text-5xl font-black">0</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-400 to-purple-600 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 text-white shadow-2xl">
                            <div class="text-center">
                                <i data-lucide="trending-up" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 mx-auto mb-2 sm:mb-4"></i>
                                <p class="text-blue-100 text-xs sm:text-sm font-bold mb-1 sm:mb-2">Progress</p>
                                <p id="progress-display" class="text-2xl sm:text-3xl md:text-5xl font-black">0/10</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rules Tab -->
                <div id="rules-content" class="space-y-6 sm:space-y-8 hidden">
                    <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8">
                        <h3 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 gradient-text">üìú IRON RULES SYSTEM</h3>
                        <div id="rules-list" class="space-y-6 sm:space-y-8"></div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logs-content" class="space-y-6 sm:space-y-8 hidden">
                    <div class="text-center">
                        <button onclick="showLogForm()" class="px-4 sm:px-6 md:px-8 py-3 sm:py-4 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-xl sm:rounded-2xl font-bold text-lg sm:text-xl shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                            üìù Log New Violation
                        </button>
                    </div>
                </div>

                <!-- Charts Tab -->
                <div id="charts-content" class="space-y-6 sm:space-y-8 hidden">
                    <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8">
                        <h3 class="text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6">üìä Violation Summary</h3>
                        <div id="charts-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 sm:gap-4"></div>
                    </div>
                    <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8">
                        <h3 class="text-xl sm:text-2xl font-bold text-center mb-6 sm:mb-8 gradient-text">üöÄ Daily Progress</h3>
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                            <div class="flex-1 sm:mr-6 md:mr-8">
                                <div class="flex items-center justify-between mb-3 sm:mb-4">
                                    <span class="text-lg sm:text-xl font-bold text-gray-700">Progress</span>
                                    <span id="progress-text" class="text-2xl sm:text-3xl font-black text-blue-600">0/10</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 sm:h-6">
                                    <div id="progress-bar" class="bg-gradient-to-r from-green-400 to-blue-600 h-4 sm:h-6 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="flex space-x-2 sm:space-x-3 justify-center sm:justify-end">
                                <button onclick="updateProgress(-1)" class="p-2 sm:p-3 md:p-4 bg-red-500 text-white rounded-lg sm:rounded-xl hover:bg-red-600 transform hover:scale-110 transition-all duration-200">
                                    <i data-lucide="minus" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"></i>
                                </button>
                                <button onclick="updateProgress(1)" class="p-2 sm:p-3 md:p-4 bg-green-500 text-white rounded-lg sm:rounded-xl hover:bg-green-600 transform hover:scale-110 transition-all duration-200">
                                    <i data-lucide="plus" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div id="history-content" class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 hidden">
                    <h3 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 gradient-text">üìö Complete History</h3>
                    <div id="history-list" class="space-y-3 sm:space-y-4 max-h-96 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 sm:mt-12 text-center text-gray-600 bg-white rounded-2xl sm:rounded-3xl shadow-lg p-4 sm:p-6 md:p-8">
                <p class="text-xs sm:text-sm mt-2 sm:mt-4 text-gray-500">Iron Discipline System v2.1 - Forge yourself through fire</p>
                <div class="mt-3 sm:mt-4 flex flex-wrap justify-center gap-2 sm:gap-4">
                    <button onclick="showExportModal()" class="text-blue-600 hover:text-blue-800 underline text-xs sm:text-sm">Export Data</button>
                    <button onclick="shareApp()" class="text-green-600 hover:text-green-800 underline text-xs sm:text-sm">Share App</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 max-w-sm sm:max-w-md w-full">
            <h3 class="text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6">üì• Export Data</h3>
            <button onclick="exportToCSV()" class="w-full p-3 sm:p-4 bg-green-100 rounded-xl hover:bg-green-200 transition-all duration-200 mb-3 sm:mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 sm:space-x-3">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 sm:w-6 sm:h-6 text-green-600"></i>
                        <div class="text-left">
                            <p class="font-bold text-green-800 text-sm sm:text-base">Export CSV</p>
                            <p class="text-xs sm:text-sm text-green-600">For Google Sheets</p>
                        </div>
                    </div>
                    <i data-lucide="download" class="w-4 h-4 sm:w-5 sm:h-5 text-green-600"></i>
                </div>
            </button>
            <button onclick="hideExportModal()" class="w-full px-4 py-2 sm:py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 text-sm sm:text-base">Close</button>
        </div>
    </div>

    <div id="logModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 max-w-sm sm:max-w-md w-full">
            <h3 class="text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6">üìù Log New Violation</h3>
            <div class="mb-4 sm:mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2">Choose a rule...</label>
                <select id="ruleSelect" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-red-500 text-sm sm:text-base">
                    <option value="">Select a rule...</option>
                </select>
            </div>
            <div id="violationTypeDiv" class="mb-4 sm:mb-6 hidden">
                <label class="block text-sm font-bold text-gray-700 mb-2">Choose violation type...</label>
                <select id="violationTypeSelect" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-red-500 text-sm sm:text-base">
                    <option value="">Select violation type...</option>
                </select>
            </div>
            <div class="flex space-x-3 sm:space-x-4">
                <button onclick="hideLogForm()" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-gray-500 text-white rounded-lg sm:rounded-xl font-bold hover:bg-gray-600 text-sm sm:text-base">Cancel</button>
                <button onclick="logViolation()" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-lg sm:rounded-xl font-bold hover:shadow-lg text-sm sm:text-base">Log Violation</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });

        // Application State
        let appData = {
            rules: [
                { id: '1.1', name: 'Missed 0730 planning', count: 0, color: '#FF6B6B' },
                { id: '1.2', name: 'Missed 2230 review', count: 0, color: '#4ECDC4' },
                { id: '1.3', name: 'Late task start', count: 0, color: '#45B7D1' },
                { id: '1.4', name: 'Dropped task midway', count: 0, color: '#96CEB4' },
                { id: '1.5', name: 'Watched adult content', count: 0, color: '#FFEAA7' }
            ],
            violationLogs: [],
            progress: 0,
            cleanDays: 0
        };

        let activeTab = 'dashboard';

        // Violation Types Data
        const violationTypes = {
            '1.1': [
                { level: 1, text: 'Planned at 0800 due to laziness', punishment: '30-min penalty task + no tea/snack' },
                { level: 2, text: 'Planned late 2‚Äì3 times/week', punishment: '‚Çπ100 fine + no phone till 10AM + redo plan log' },
                { level: 3, text: 'No planning entire week', punishment: '3-day 4AM wakeup + cold bath + 5km walk' },
                { level: 4, text: 'Rejected planning system for 5+ days', punishment: '7-day reset: 4AM wake, 1 meal/day, mirror ban, silence till noon' }
            ],
            '1.2': [
                { level: 1, text: 'Forgot once, distracted by phone', punishment: 'Cold sit (15 mins) + redo log + no pillow' },
                { level: 2, text: 'Skipped review 2‚Äì3√ó week', punishment: '2-page weekly log + digital blackout after 9PM' },
                { level: 3, text: 'Lied in log or fake review', punishment: 'Handwrite full week log + 3-min voice confession' },
                { level: 4, text: 'Faked review all week or refused log', punishment: '7-day Truth Journal + record 5-min "I Lied" confession' }
            ],
            '1.3': [
                { level: 1, text: 'Task delayed by 5‚Äì10 min once', punishment: 'Task repeated + 24-hr no music' },
                { level: 2, text: 'Delayed task 3+ times/week', punishment: '‚Çπ100 fine + double task duration + log sent' },
                { level: 3, text: 'Marked fake start or lied in log', punishment: '‚Çπ200 fine + 200 pushups (in 2 days) + public log' },
                { level: 4, text: 'Mocked discipline system or refused schedule', punishment: '3-day timing bootcamp: 5km walk, no phone till 12PM, mirror ban' }
            ],
            '1.4': [
                { level: 1, text: 'Lost focus mid-task but resumed', punishment: 'Restart task + no reels for 24 hrs' },
                { level: 2, text: 'Quit task halfway 2‚Äì3√ó/week', punishment: '12-hr silent mode + redo task + skip 1 meal' },
                { level: 3, text: 'Gave excuse and abandoned work', punishment: '3-day no-comfort mode: 1 meal/day, no music, 2√ó work' },
                { level: 4, text: 'Rage-quit habit system fully', punishment: '7-day warrior mode: 4AM wake, cold shower, mirror ban, double duties' }
            ],
            '1.5': [
                { level: 1, text: 'Clicked accidentally, exited immediately', punishment: '2-page discipline note + fast till 6PM' },
                { level: 2, text: 'Watched 1‚Äì2 min without guilt', punishment: '24-hr lockdown: no phone, plain food, 2-page reflection' },
                { level: 3, text: 'Relapsed 2‚Äì3 days & justified it', punishment: '2-day fruit fast + delete apps + 3-page purge journal' },
                { level: 4, text: 'Binge 4+ days, denied guilt, no action taken', punishment: '7-day soul cleanse: 4AM wake, 1 meal/day, no mirror, breakup letter to lust self' }
            ]
        };

        // Storage Functions
        function saveData() {
            try {
                localStorage.setItem('iron_discipline_data', JSON.stringify(appData));
                document.getElementById('status').innerHTML = 'Status: ‚úÖ Saved';
                setTimeout(() => {
                    document.getElementById('status').innerHTML = 'Status: üîÑ Ready';
                }, 2000);
            } catch (error) {
                document.getElementById('status').innerHTML = 'Status: ‚ùå Error';
            }
        }

        function loadData() {
            try {
                const stored = localStorage.getItem('iron_discipline_data');
                if (stored) {
                    appData = JSON.parse(stored);
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            updateDisplay();
        }

        // Tab Functions
        function setActiveTab(tabName) {
            activeTab = tabName;
            
            // Hide all content
            document.querySelectorAll('[id$="-content"]').forEach(el => el.classList.add('hidden'));
            
            // Show selected content
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = btn.className.replace('bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-lg', 'hover:bg-gray-100 text-gray-600');
            });
            
            document.getElementById('tab-' + tabName).className = document.getElementById('tab-' + tabName).className.replace('hover:bg-gray-100 text-gray-600', 'bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-lg');
            
            updateDisplay();
        }

        // Display Update Functions
        function updateDisplay() {
            updateStats();
            updateRulesList();
            updateCharts();
            updateHistory();
        }

        function updateStats() {
            const totalViolations = appData.rules.reduce((sum, rule) => sum + (rule.count || 0), 0);
            const criticalViolations = appData.rules.filter(rule => (rule.count || 0) >= 4).length;
            
            document.getElementById('total-violations').textContent = totalViolations;
            document.getElementById('critical-violations').textContent = criticalViolations;
            document.getElementById('clean-days').textContent = appData.cleanDays;
            document.getElementById('progress-display').textContent = appData.progress + '/10';
            document.getElementById('progress-text').textContent = appData.progress + '/10';
            document.getElementById('progress-bar').style.width = (appData.progress / 10 * 100) + '%';
            document.getElementById('records').textContent = `Records: ${appData.violationLogs.length} violations ‚Ä¢ ${totalViolations} rule breaches`;
        }

        function updateRulesList() {
            const rulesList = document.getElementById('rules-list');
            rulesList.innerHTML = '';
            
            appData.rules.forEach(rule => {
                const ruleDiv = document.createElement('div');
                ruleDiv.className = 'bg-gradient-to-r from-gray-50 to-white rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 shadow-lg border-l-4 sm:border-l-8';
                ruleDiv.style.borderLeftColor = rule.color;
                
                const levelColor = getLevelColor(rule.count);
                const levelText = getLevelText(rule.count);
                
                ruleDiv.innerHTML = `
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 sm:mb-6">
                        <div class="mb-4 sm:mb-0">
                            <h4 class="text-xl sm:text-2xl font-bold text-gray-800">Rule ${rule.id}</h4>
                            <p class="text-sm sm:text-base md:text-lg text-gray-600">${rule.name}</p>
                        </div>
                        <div class="px-4 sm:px-6 py-2 sm:py-3 rounded-full text-lg sm:text-xl font-black ${levelColor}">
                            ${levelText} (${rule.count || 0})
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                        ${getViolationLevelsHTML(rule.id)}
                    </div>
                `;
                
                rulesList.appendChild(ruleDiv);
            });
        }

        function getViolationLevelsHTML(ruleId) {
            const types = violationTypes[ruleId] || [];
            const colors = ['yellow', 'orange', 'red', 'red'];
            const labels = ['Minor', 'Moderate', 'Major', 'Critical'];
            
            return types.map((type, index) => `
                <div class="bg-${colors[index]}-50 rounded-lg sm:rounded-xl p-3 sm:p-4 border border-${colors[index]}-200">
                    <h5 class="font-bold text-${colors[index]}-800 mb-2 text-sm sm:text-base">Level ${type.level}: ${labels[index]}</h5>
                    <p class="text-xs sm:text-sm text-${colors[index]}-700">${type.text}</p>
                    <p class="text-xs sm:text-sm text-${colors[index]}-600 mt-2 font-semibold">‚Üí ${type.punishment}</p>
                </div>
            `).join('');
        }

        function updateCharts() {
            const chartsGrid = document.getElementById('charts-grid');
            chartsGrid.innerHTML = '';
            
            appData.rules.forEach(rule => {
                const chartDiv = document.createElement('div');
                chartDiv.className = 'text-center p-3 sm:p-4 rounded-lg sm:rounded-xl border';
                chartDiv.style.borderColor = rule.color;
                
                chartDiv.innerHTML = `
                    <div class="w-6 h-6 sm:w-8 sm:h-8 rounded-full mx-auto mb-2" style="background-color: ${rule.color}"></div>
                    <p class="text-xs sm:text-sm font-bold">${rule.id}</p>
                    <p class="text-xl sm:text-2xl font-black" style="color: ${rule.color}">${rule.count || 0}</p>
                `;
                
                chartsGrid.appendChild(chartDiv);
            });
        }

        function updateHistory() {
            const historyList = document.getElementById('history-list');
            
            if (appData.violationLogs.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-8 sm:py-12">
                        <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 mx-auto mb-4 text-gray-300">üìö</div>
                        <p class="text-lg sm:text-xl text-gray-500">No history available</p>
                        <p class="text-sm mt-2 text-gray-400">Start logging violations to build history</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = '';
            appData.violationLogs.forEach(log => {
                const logDiv = document.createElement('div');
                logDiv.className = 'flex items-center justify-between p-3 sm:p-4 md:p-6 bg-gradient-to-r from-gray-50 to-white rounded-lg sm:rounded-xl shadow-md';
                
                logDiv.innerHTML = `
                    <div class="flex items-center space-x-3 sm:space-x-4 flex-1">
                        <div class="w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-red-500"></div>
                        <div class="flex-1 min-w-0">
                            <p class="font-bold text-gray-800 text-sm sm:text-base truncate">Rule ${log.ruleId}: ${log.ruleName}</p>
                            <p class="text-xs sm:text-sm text-gray-600 truncate">${log.violationType}</p>
                            <p class="text-xs text-gray-500">Level ${log.level} - ${log.punishment}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-3 flex-shrink-0">
                        <div class="text-xs sm:text-sm text-gray-500 text-right">
                            <div>${new Date(log.timestamp).toLocaleDateString()}</div>
                            <div class="hidden sm:block">${new Date(log.timestamp).toLocaleTimeString()}</div>
                        </div>
                        <button onclick="deleteLog(${log.id})" class="p-1 sm:p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transform hover:scale-110 transition-all duration-200" title="Delete">
                            <i data-lucide="minus" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                        </button>
                    </div>
                `;
                
                historyList.appendChild(logDiv);
            });
            
            // Re-initialize Lucide icons for new buttons
            lucide.createIcons();
        }

        // Violation Logging Functions
        function showLogForm() {
            const ruleSelect = document.getElementById('ruleSelect');
            ruleSelect.innerHTML = '<option value="">Select a rule...</option>';
            
            appData.rules.forEach(rule => {
                const option = document.createElement('option');
                option.value = rule.id;
                option.textContent = `${rule.id} - ${rule.name}`;
                ruleSelect.appendChild(option);
            });
            
            ruleSelect.onchange = function() {
                const violationDiv = document.getElementById('violationTypeDiv');
                const violationSelect = document.getElementById('violationTypeSelect');
                
                if (this.value) {
                    violationDiv.classList.remove('hidden');
                    violationSelect.innerHTML = '<option value="">Select violation type...</option>';
                    
                    const types = violationTypes[this.value] || [];
                    types.forEach(type => {
                        const option = document.createElement('option');
                        option.value = JSON.stringify(type);
                        option.textContent = `Level ${type.level}: ${type.text}`;
                        violationSelect.appendChild(option);
                    });
                } else {
                    violationDiv.classList.add('hidden');
                }
            };
            
            document.getElementById('logModal').classList.remove('hidden');
        }

        function hideLogForm() {
            document.getElementById('logModal').classList.add('hidden');
            document.getElementById('violationTypeDiv').classList.add('hidden');
        }

        function logViolation() {
            const ruleSelect = document.getElementById('ruleSelect');
            const violationSelect = document.getElementById('violationTypeSelect');
            
            if (!ruleSelect.value || !violationSelect.value) {
                alert('Please select both rule and violation type');
                return;
            }
            
            const rule = appData.rules.find(r => r.id === ruleSelect.value);
            const violationType = JSON.parse(violationSelect.value);
            
            const newLog = {
                id: Date.now(),
                ruleId: ruleSelect.value,
                ruleName: rule.name,
                timestamp: new Date().toISOString(),
                level: violationType.level,
                violationType: violationType.text,
                punishment: violationType.punishment
            };
            
            appData.violationLogs.unshift(newLog);
            rule.count = (rule.count || 0) + 1;
            appData.cleanDays = 0;
            
            saveData();
            updateDisplay();
            hideLogForm();
            
            alert('‚úÖ Violation logged successfully!');
        }

        function deleteLog(logId) {
            if (confirm('Delete this violation log?')) {
                appData.violationLogs = appData.violationLogs.filter(log => log.id !== logId);
                saveData();
                updateDisplay();
            }
        }

        // Progress Functions
        function updateProgress(change) {
            appData.progress = Math.max(0, Math.min(10, appData.progress + change));
            saveData();
            updateDisplay();
        }

        // Utility Functions
        function getLevelColor(count) {
            const safeCount = count || 0;
            if (safeCount === 0) return 'bg-green-100 text-green-700';
            if (safeCount <= 1) return 'bg-yellow-100 text-yellow-700';
            if (safeCount <= 2) return 'bg-orange-100 text-orange-700';
            if (safeCount <= 3) return 'bg-red-100 text-red-700';
            return 'bg-red-200 text-red-800';
        }

        function getLevelText(count) {
            const safeCount = count || 0;
            if (safeCount === 0) return 'Clean';
            if (safeCount <= 1) return 'Minor';
            if (safeCount <= 2) return 'Moderate';
            if (safeCount <= 3) return 'Major';
            return 'CRITICAL';
        }

        // Export/Import Functions
        function showExportModal() {
            document.getElementById('exportModal').classList.remove('hidden');
        }

        function hideExportModal() {
            document.getElementById('exportModal').classList.add('hidden');
        }

        function exportToCSV() {
            try {
                const headers = ['Date', 'Time', 'Rule ID', 'Rule Name', 'Level', 'Violation Type', 'Punishment'];
                const csvData = [
                    headers,
                    ...appData.violationLogs.map(log => [
                        new Date(log.timestamp).toLocaleDateString(),
                        new Date(log.timestamp).toLocaleTimeString(),
                        log.ruleId,
                        log.ruleName,
                        log.level,
                        log.violationType,
                        log.punishment
                    ])
                ];
                
                const csvContent = csvData.map(row => 
                    row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
                ).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `discipline-violations-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('‚úÖ CSV exported for Google Sheets!');
                hideExportModal();
            } catch (error) {
                alert('‚ùå Export failed');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.rules) appData.rules = importedData.rules;
                    if (importedData.violationLogs) appData.violationLogs = importedData.violationLogs;
                    if (importedData.progress !== undefined) appData.progress = importedData.progress;
                    if (importedData.cleanDays !== undefined) appData.cleanDays = importedData.cleanDays;
                    
                    saveData();
                    updateDisplay();
                    alert('‚úÖ Data imported successfully!');
                } catch (error) {
                    alert('‚ùå Invalid file format');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function shareApp() {
            try {
                const url = window.location.href;
                const textArea = document.createElement('textarea');
                textArea.value = url;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ Link copied to clipboard!');
            } catch (error) {
                alert('‚ùå Unable to copy link');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will delete ALL your data. Are you sure?')) {
                try {
                    localStorage.removeItem('iron_discipline_data');
                    appData = {
                        rules: [
                            { id: '1.1', name: 'Missed 0730 planning', count: 0, color: '#FF6B6B' },
                            { id: '1.2', name: 'Missed 2230 review', count: 0, color: '#4ECDC4' },
                            { id: '1.3', name: 'Late task start', count: 0, color: '#45B7D1' },
                            { id: '1.4', name: 'Dropped task midway', count: 0, color: '#96CEB4' },
                            { id: '1.5', name: 'Watched adult content', count: 0, color: '#FFEAA7' }
                        ],
                        violationLogs: [],
                        progress: 0,
                        cleanDays: 0
                    };
                    updateDisplay();
                    alert('‚úÖ All data cleared');
                } catch (error) {
                    alert('‚ùå Error clearing data');
                }
            }
        }

        // Initialize app
        window.addEventListener('load', function() {
            loadData();
            setActiveTab('dashboard');
        });
    </script>
</body>
</html>
